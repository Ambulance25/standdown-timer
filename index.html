<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>2-Hour Standdown Timer</title>
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <style>
    body {
      font-family: system-ui,-apple-system,BlinkMacSystemFont,sans-serif;
      background: #0f172a;
      color: #f0f6ff;
      display: flex;
      flex-direction: column;
      align-items: center;
      padding: 2rem;
      min-height: 100vh;
      gap: 1rem;
    }
    .card {
      background: #1e2a44;
      padding: 1.5rem 2rem;
      border-radius: 12px;
      box-shadow: 0 12px 36px rgba(0,0,0,0.3);
      max-width: 500px;
      width: 100%;
      text-align: center;
    }
    h1 {
      margin: 0 0 0.5rem;
      font-size: 1.75rem;
    }
    .timer {
      font-size: 3.5rem;
      font-weight: 600;
      margin: 1rem 0;
      letter-spacing: 0.05em;
    }
    button {
      background: #6366f1;
      border: none;
      padding: 0.75rem 1.25rem;
      border-radius: 8px;
      cursor: pointer;
      font-size: 1rem;
      color: white;
      margin: 0 0.25rem;
      transition: background .2s;
    }
    button:disabled {
      opacity: 0.5;
      cursor: default;
    }
    button:hover:not(:disabled) { background: #4f46e5; }
    .note {
      font-size: .9rem;
      margin-top: .75rem;
      background: rgba(255,255,255,0.05);
      padding: 0.5rem;
      border-radius: 6px;
    }
    .done {
      color: #10b981;
    }
  </style>
</head>
<body>
  <div class="card">
    <h1>2-Hour Standdown Timer</h1>
    <div class="timer" id="display">02:00:00</div>
    <div>
      <button id="startBtn" disabled>Start</button>
      <button id="pauseBtn">Pause</button>
      <button id="resetBtn">Reset</button>
    </div>
    <div class="note">
      After you submit a request, this timer starts automatically. You must wait the full <strong>2 hours</strong> before submitting another request.  
      <div id="status" style="margin-top:.5rem;"></div>
    </div>
  </div>

  <script>
    const display = document.getElementById('display');
    const startBtn = document.getElementById('startBtn');
    const pauseBtn = document.getElementById('pauseBtn');
    const resetBtn = document.getElementById('resetBtn');
    const status = document.getElementById('status');

    const FULL = 2 * 60 * 60; // seconds
    let remaining = FULL;
    let interval = null;
    let running = false;

    const STORAGE_KEY = 'standdown_timer_state';

    function format(sec) {
      const h = Math.floor(sec / 3600).toString().padStart(2,'0');
      const m = Math.floor((sec % 3600)/60).toString().padStart(2,'0');
      const s = Math.floor(sec % 60).toString().padStart(2,'0');
      return `${h}:${m}:${s}`;
    }

    function saveState() {
      const payload = {
        remaining,
        running,
        timestamp: Date.now()
      };
      localStorage.setItem(STORAGE_KEY, JSON.stringify(payload));
    }

    function loadState() {
      const stored = localStorage.getItem(STORAGE_KEY);
      if (!stored) return;
      try {
        const obj = JSON.parse(stored);
        if (typeof obj.remaining === 'number') remaining = obj.remaining;
        if (typeof obj.running === 'boolean') running = obj.running;

        // If running, adjust for time passed since last save
        if (running && typeof obj.timestamp === 'number') {
          const elapsed = Math.floor((Date.now() - obj.timestamp) / 1000);
          remaining = Math.max(0, remaining - elapsed);
        }
      } catch {}
    }

    function updateDisplay() {
      display.textContent = format(remaining);
      if (remaining === 0) {
        status.innerHTML = '<span class="done">Standdown complete. You may submit again.</span>';
        clearInterval(interval);
        running = false;
        startBtn.disabled = true;
        pauseBtn.disabled = true;
        saveState();
      }
    }

    function tick() {
      if (remaining > 0) {
        remaining--;
        updateDisplay();
        saveState();
      }
    }

    function startTimer() {
      if (running) return;
      running = true;
      status.textContent = 'Timer running…';
      interval = setInterval(tick, 1000);
      startBtn.disabled = true;
      pauseBtn.disabled = false;
      saveState();
    }

    function pauseTimer() {
      if (!running) return;
      clearInterval(interval);
      running = false;
      status.textContent = 'Paused.';
      startBtn.disabled = false;
      pauseBtn.disabled = true;
      saveState();
    }

    function resetTimer() {
      clearInterval(interval);
      remaining = FULL;
      running = false;
      updateDisplay();
      status.textContent = '';
      startBtn.disabled = true;
      pauseBtn.disabled = true;
      saveState();
    }

    // Button handlers
    pauseBtn.addEventListener('click', () => {
      pauseTimer();
    });

    resetBtn.addEventListener('click', () => {
      resetTimer();
    });

    // Initialization
    loadState();
    updateDisplay();

    // If already complete
    if (remaining === 0) {
      startBtn.disabled = true;
      pauseBtn.disabled = true;
    } else {
      // Auto-start when page loads if not already running or completed
      if (!running) {
        startTimer();
      } else {
        status.textContent = 'Resuming timer…';
        interval = setInterval(tick, 1000);
        startBtn.disabled = true;
        pauseBtn.disabled = false;
      }
    }
  </script>
</body>
</html>
